<!DOCTYPE html>
<html lang='en'>

<head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='Taking it a step further'>
<meta name='theme-color' content='#ffcd00'>

<meta property='og:title' content='Using Excel To Compare Multiple XMLs • Praveen Lobo'>
<meta property='og:description' content='Taking it a step further'>
<meta property='og:url' content='https://praveenlobo.com/blog/using-excel-to-compare-multiple-xmls/'>
<meta property='og:site_name' content='Praveen Lobo'>
<meta property='og:type' content='article'><meta property='article:section' content='Blog'><meta property='article:tag' content='XML'><meta property='article:tag' content='VBA'><meta property='article:tag' content='excel'><meta property='article:tag' content='power query'><meta property='article:published_time' content='2014-10-05T00:00:00Z'/><meta property='article:modified_time' content='2014-10-05T00:00:00Z'/><meta name='twitter:card' content='summary'>

<meta name="generator" content="Hugo 0.43-DEV" />

  <title>Using Excel To Compare Multiple XMLs • Praveen Lobo</title>
  <link rel='canonical' href='https://praveenlobo.com/blog/using-excel-to-compare-multiple-xmls/'>
  
  
  <link rel='icon' href='/favicon.ico'>
<link rel='stylesheet' href='/assets/css/main.b0a0b202.css'><style>
:root{--color-accent:#ffcd00;}
</style>

<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-20788457-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>


<body class='page type-blog'>

  <div class='site'>

    <a class='screen-reader-text' href='#content'>Skip to Content</a>

    <div class='main'>

      <nav id='main-menu' class='menu main-menu' aria-label='Main Menu'>
  <div class='container'>
    
    <ul><li class='item'>
        <a href='/'>Home</a>
      </li><li class='item'>
        <a href='https://www.google.com/search?q=site:praveenlobo.com'>Search</a>
      </li><li class='item'>
        <a href='/blog'>Blog</a>
      </li><li class='item'>
        <a href='/reviews-and-referral-links'>Reviews</a>
      </li><li class='item'>
        <a href='/archive'>Archive</a>
      </li><li class='item'>
        <a href='/subscribe'>Subscribe</a>
      </li><li class='item'>
        <a href='/contact'>Contact</a>
      </li><li class='item'>
        <a href='/about'>About</a>
      </li></ul>
  </div>
</nav>

      <header id='header' class='header site-header'>
        <div class='container sep-after'>
          <div class='header-info'><p class='site-title title'>Praveen Lobo</p><p class='desc site-desc'></p>
          </div>
        </div>
      </header>

      <main id='content'>


<article lang='en' class='entry'>
  <header class='header entry-header'>
  <div class='container sep-after'>
    <div class='header-info'>
      <h1 class='title'>Using Excel To Compare Multiple XMLs</h1>
      
<p class='desc'>Taking it a step further</p>


    </div>
    
<div class='entry-meta'>
  <span class='posted-on'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
  <line x1="16" y1="2" x2="16" y2="6"/>
  <line x1="8" y1="2" x2="8" y2="6"/>
  <line x1="3" y1="10" x2="21" y2="10"/>
  
</svg>
<span class='screen-reader-text'>Posted on </span>
  <time class='entry-date' datetime='2014-10-05T00:00:00Z'>Sun, Oct 5, 2014</time>
</span>

  
  
<span class='reading-time'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <circle cx="12" cy="12" r="10"/>
  <polyline points="12 6 12 12 15 15"/>
  
</svg>
8 mins read
</span>


</div>


  </div>
</header>

  
  

  <div class='container entry-content'>
  

<p>The VBA code from <a href="/blog/comparing-two-xmls-in-excel-vba">last post</a> explains how two XML strings that are already on the spreadsheet can be compared. This can be extended to add a search functionality to search and bring in the XML before running the comparison.</p>

<h4 id="search-file">Search File:</h4>

<p>To get a matching line from a file, use VBA code as shown <a href="https://github.com/lobopraveen/gists/blob/master/msexcel/vba_extract_matching_line_from_a_file.vba" target="_blank">here</a> on the gists repo I maintain. Or just use power query as shown below and place the result in the XML cell. Note that the power query returns all matching lines as opposed to the aforementioned VBA code which returns the first occurrence. The VBA code can be edited to return multiple lines if needed.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-m" data-lang="m">let
    KeySource <span style="color:#f92672">=</span> Excel.CurrentWorkbook(){[Name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;SearchKeys&#34;</span>]}[Content],
    KeysWithoutNull <span style="color:#f92672">=</span> Table.SelectRows(KeySource, each [Keys] <span style="color:#f92672">&lt;&gt;</span> null),
    DistinctKeyList <span style="color:#f92672">=</span> List.Distinct(KeysWithoutNull[Keys]),
    TxtFileData <span style="color:#f92672">=</span> Table.FromColumns({Lines.FromBinary(File.Contents(<span style="color:#e6db74">&#34;File_Location_here&#34;</span>))}),
    FilteredRows <span style="color:#f92672">=</span> Table.SelectRows(TxtFileData, each List.AnyTrue(List.Transform(DistinctKeyList, (substring) <span style="color:#f92672">=&gt;</span> Text.Contains([Column1], substring)))),
    MatchingLines <span style="color:#f92672">=</span> Table.RenameColumns(FilteredRows,{{<span style="color:#e6db74">&#34;Column1&#34;</span>, <span style="color:#e6db74">&#34;Lines From File&#34;</span>}})
<span style="color:#66d9ef">in</span>
    MatchingLines</code></pre></div>
<p>The code assumes that the key to search is in a table named &ldquo;SearchKeys&rdquo;.</p>

<h4 id="search-database">Search Database:</h4>

<p>Power query makes like easy to run a query against a database.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-m" data-lang="m">let
    KeySource <span style="color:#f92672">=</span> Excel.CurrentWorkbook(){[Name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;SearchKeys&#34;</span>]}[Content],
    KeysWithoutNull <span style="color:#f92672">=</span> Table.SelectRows(KeySource, each [Keys] <span style="color:#f92672">&lt;&gt;</span> null),
    DistinctKeyList <span style="color:#f92672">=</span> List.Distinct(KeysWithoutNull[Keys]),
    OneLiner <span style="color:#f92672">=</span> List.Accumulate(DistinctKeyList,<span style="color:#e6db74">&#34;&#34;</span>,(state,current)<span style="color:#f92672">=&gt;</span><span style="color:#66d9ef">if</span> state <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span> then <span style="color:#e6db74">&#34;&#39;&#34;</span><span style="color:#f92672">&amp;</span> Text.From(current)<span style="color:#f92672">&amp;</span><span style="color:#e6db74">&#34;&#39;&#34;</span> <span style="color:#66d9ef">else</span> state <span style="color:#f92672">&amp;</span> <span style="color:#e6db74">&#34;,&#39;&#34;</span><span style="color:#f92672">&amp;</span> Text.From(current) <span style="color:#f92672">&amp;</span><span style="color:#e6db74">&#34;&#39;&#34;</span> ),
    DBData <span style="color:#f92672">=</span> Sql.Database(<span style="color:#e6db74">&#34;server&#34;</span>, <span style="color:#e6db74">&#34;db&#34;</span>, [Query<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;SELECT * FROM dbo.tablename WHERE somecolumn IN (&#34;</span><span style="color:#f92672">&amp;</span> OneLiner <span style="color:#f92672">&amp;</span><span style="color:#e6db74">&#34;)&#34;</span>])
<span style="color:#66d9ef">in</span>
    DBData</code></pre></div>
<p>Using the snippets shown above XML strings to compare can be brought in to the spreadsheet before running the comparison. This way an XML string from a file can be compared to another one from a different file or even a database.</p>

<h4 id="comparing-multiple-xml-strings">Comparing multiple XML strings:</h4>

<p>The VBA code from <a href="/blog/comparing-two-xmls-in-excel-vba">previous post</a> talked about comparing a single XML. That same code can be put in a loop to compare multiple XML strings. The use case below lists a set of keys for which the matching XML strings from a file needs to be compared to matching XML strings from a database.</p>

<div class='align-center'>
  <figure>
    <a href="/media/51-75/53-excel-xml-compare/search_and_compare_multiple_XMLs.png">
        <img src="/media/51-75/53-excel-xml-compare/search_and_compare_multiple_XMLs.png" alt="search_and_compare_multiple_XMLs.png" />
    </a>
    
    <figcaption>
        <p>
        Compare multiple XML strings
        
            
        
        </p> 
    </figcaption>
    
</figure>

</div>


<p>The &ldquo;SearchKeys&rdquo; mentioned above is a table and can take multiple rows/keys. There are three keys in the screenshot shown above (refer column A).</p>

<ol>
<li><p>The &ldquo;Search File&rdquo; can be assigned to a macro that refreshes the connection for the file search power query from above. The result of the power query should go to the &ldquo;file&rdquo; sheet.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp">ThisWorkbook.Connections(<span style="color:#e6db74">&#34;Query - FileSearch&#34;</span>).Refresh</code></pre></div></li>

<li><p>The &ldquo;Search DB&rdquo; can run the database search power query and load the &ldquo;database&rdquo; sheet.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp">ThisWorkbook.Connections(<span style="color:#e6db74">&#34;Query - DBSearch&#34;</span>).Refresh</code></pre></div></li>

<li><p>Loop through the keys</p>

<ol>
<li>find the matching XML from the &ldquo;file&rdquo; sheet and the &ldquo;database&rdquo; sheet</li>
<li>run the xml compare using the same strategy from previous post.</li>
</ol></li>
</ol>

<p>Following code can be used to find the matching XML from a list that is already loaded into one of the sheets.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#e6db74">&#39;
</span><span style="color:#e6db74">&#39;</span> returns the first xml that matches a given key <span style="color:#66d9ef">on</span> a given sheet
<span style="color:#960050;background-color:#1e0010">&#39;</span> Note: assumes column A has the xmls starting at row <span style="color:#ae81ff">2</span>
<span style="color:#960050;background-color:#1e0010">&#39;</span>
Function GetFileXML(SheetName As String, Key As String) As String
    Dim xml As Range
    Set xml = ThisWorkbook.Sheets(SheetName).Range(<span style="color:#e6db74">&#34;A2&#34;</span>)

    Do Until IsEmpty(xml)
        If InStr(<span style="color:#ae81ff">1</span>, xml.Text, Key, vbTextCompare) &gt; <span style="color:#ae81ff">0</span> Then
            GetFileXML = xml.Text
            Exit Function
        End If
        Set xml = xml.Offset(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>)
    Loop
End Function</code></pre></div>
<p>In the code below, I added <code>GetDBXML()</code> function just to demonstrate another use case where the database result has two columns - the actual key and the XMl string. The function searches the key column by passing the text from key column <code>xml.Offset(0, -1).Text</code> to the <code>InStr</code> function.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#e6db74">&#39;
</span><span style="color:#e6db74">&#39;</span> MIT License
<span style="color:#e6db74">&#39;
</span><span style="color:#e6db74">&#39;</span> Copyright (c) <span style="color:#ae81ff">2018</span> Praveen Lobo (praveenlobo.com)
<span style="color:#e6db74">&#39;
</span><span style="color:#e6db74">&#39;</span> Permission <span style="color:#66d9ef">is</span> hereby granted, free of charge, to any person obtaining a copy
<span style="color:#960050;background-color:#1e0010">&#39;</span> of <span style="color:#66d9ef">this</span> software and associated documentation files (the <span style="color:#e6db74">&#34;Software&#34;</span>), to deal
<span style="color:#960050;background-color:#1e0010">&#39;</span> <span style="color:#66d9ef">in</span> the Software without restriction, including without limitation the rights
<span style="color:#960050;background-color:#1e0010">&#39;</span> to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
<span style="color:#960050;background-color:#1e0010">&#39;</span> copies of the Software, and to permit persons to whom the Software <span style="color:#66d9ef">is</span>
<span style="color:#960050;background-color:#1e0010">&#39;</span> furnished to <span style="color:#66d9ef">do</span> so, subject to the following conditions:
<span style="color:#e6db74">&#39;
</span><span style="color:#e6db74">&#39;</span> The above copyright notice and <span style="color:#66d9ef">this</span> permission notice shall be included <span style="color:#66d9ef">in</span> all
<span style="color:#960050;background-color:#1e0010">&#39;</span> copies or substantial portions of the Software.
<span style="color:#e6db74">&#39;
</span><span style="color:#e6db74">&#39;</span> THE SOFTWARE IS PROVIDED <span style="color:#e6db74">&#34;AS IS&#34;</span>, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
<span style="color:#960050;background-color:#1e0010">&#39;</span> IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
<span style="color:#960050;background-color:#1e0010">&#39;</span> FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
<span style="color:#960050;background-color:#1e0010">&#39;</span> AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
<span style="color:#960050;background-color:#1e0010">&#39;</span> LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
<span style="color:#960050;background-color:#1e0010">&#39;</span> OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
<span style="color:#960050;background-color:#1e0010">&#39;</span> SOFTWARE.
<span style="color:#960050;background-color:#1e0010">&#39;</span>

<span style="color:#e6db74">&#39;
</span><span style="color:#e6db74">&#39;</span> Refreshes the key list and searches <span style="color:#66d9ef">for</span> those keys <span style="color:#66d9ef">in</span> the file <span style="color:#66d9ef">using</span> the FileSearch power query
<span style="color:#960050;background-color:#1e0010">&#39;</span>
Sub RefreshFileSearch()
    ClearPreviousResults
    ThisWorkbook.Connections(<span style="color:#e6db74">&#34;Query - FileSearch&#34;</span>).Refresh
End Sub

<span style="color:#e6db74">&#39;
</span><span style="color:#e6db74">&#39;</span> Refreshes the key list and searches <span style="color:#66d9ef">for</span> those keys <span style="color:#66d9ef">in</span> the databse <span style="color:#66d9ef">using</span> the DBSearch power query
<span style="color:#960050;background-color:#1e0010">&#39;</span>
Sub RefreshDBSearch()
    ClearPreviousResults
    ThisWorkbook.Connections(<span style="color:#e6db74">&#34;Query - DBSearch&#34;</span>).Refresh
End Sub

<span style="color:#e6db74">&#39;
</span><span style="color:#e6db74">&#39;</span> Returns the range of previous compare results
<span style="color:#960050;background-color:#1e0010">&#39;</span>
Function CompareResultRange() As Range
    On Error Resume Next
    ThisWorkbook.Sheets(<span style="color:#e6db74">&#34;Main&#34;</span>).ShowAllData
    On Error GoTo <span style="color:#ae81ff">0</span>
    ThisWorkbook.Sheets(<span style="color:#e6db74">&#34;Main&#34;</span>).Range(<span style="color:#e6db74">&#34;C2&#34;</span>).Select
    <span style="color:#960050;background-color:#1e0010">&#39;</span> Select all down only <span style="color:#66d9ef">if</span> there <span style="color:#66d9ef">is</span> any <span style="color:#66d9ef">value</span>
    If IsEmpty(Range(<span style="color:#e6db74">&#34;C2&#34;</span>).Offset(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>).Value) = False Then
        Range(Selection, Selection.End(xlDown)).Select
    End If

    <span style="color:#960050;background-color:#1e0010">&#39;</span> Extend the selection to <span style="color:#66d9ef">add</span> six columns
    Selection.Resize(Selection.Rows.count, <span style="color:#ae81ff">6</span>).Select
    Set CompareResultRange = Selection
End Function

<span style="color:#e6db74">&#39;
</span><span style="color:#e6db74">&#39;</span> Clears the previous results
<span style="color:#960050;background-color:#1e0010">&#39;</span>
Sub ClearPreviousResults()

    With CompareResultRange()
        .ClearContents
        .FormatConditions.Delete
        .Interior.Color = xlNone
        With .Borders
            .LineStyle = xlNone
        End With
    End With

    ThisWorkbook.Sheets(<span style="color:#e6db74">&#34;Main&#34;</span>).Range(<span style="color:#e6db74">&#34;C2&#34;</span>).Select
    ActiveWindow.ScrollRow = <span style="color:#ae81ff">1</span>
End Sub

<span style="color:#e6db74">&#39;
</span><span style="color:#e6db74">&#39;</span> returns the first xml that matches a given key <span style="color:#66d9ef">on</span> a given sheet
<span style="color:#960050;background-color:#1e0010">&#39;</span> Note: assumes column A has the xmls starting at row <span style="color:#ae81ff">2</span>
<span style="color:#960050;background-color:#1e0010">&#39;</span>
Function GetFileXML(SheetName As String, Key As String) As String
    Dim xml As Range
    Set xml = ThisWorkbook.Sheets(SheetName).Range(<span style="color:#e6db74">&#34;A2&#34;</span>)

    Do Until IsEmpty(xml)
        If InStr(<span style="color:#ae81ff">1</span>, xml.Text, Key, vbTextCompare) &gt; <span style="color:#ae81ff">0</span> Then
            GetFileXML = xml.Text
            Exit Function
        End If
        Set xml = xml.Offset(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>)
    Loop
End Function

<span style="color:#e6db74">&#39;
</span><span style="color:#e6db74">&#39;</span> returns the first xml <span style="color:#66d9ef">from</span> a row that matches a given key <span style="color:#66d9ef">on</span> a given sheet.
<span style="color:#960050;background-color:#1e0010">&#39;</span> Note: assumes that column A has the keys and columb B has the xmls starting row <span style="color:#ae81ff">2</span>
<span style="color:#960050;background-color:#1e0010">&#39;</span>
Function GetDBXML(SheetName As String, Key As String) As String
    Dim xml As Range
    Set xml = ThisWorkbook.Sheets(SheetName).Range(<span style="color:#e6db74">&#34;B2&#34;</span>)

    Do Until IsEmpty(xml)
        If InStr(<span style="color:#ae81ff">1</span>, xml.Offset(<span style="color:#ae81ff">0</span>, -<span style="color:#ae81ff">1</span>).Text, Key, vbTextCompare) &gt; <span style="color:#ae81ff">0</span> Then
            GetDBXML = xml.Text
            Exit Function
        End If
        Set xml = xml.Offset(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>)
    Loop
End Function

<span style="color:#e6db74">&#39;
</span><span style="color:#e6db74">&#39;</span> Compares the two XMLs and displays mismatches
<span style="color:#960050;background-color:#1e0010">&#39;</span>
Sub CompareXMLs()
    ClearPreviousResults
    Dim CompareResultCell As Range
    Set CompareResultCell = ThisWorkbook.Sheets(<span style="color:#e6db74">&#34;Main&#34;</span>).Range(<span style="color:#e6db74">&#34;C2&#34;</span>)

    Dim xml As MSXML2.DOMDocument
    Set xml = New MSXML2.DOMDocument
    xml.<span style="color:#66d9ef">async</span> = False: xml.ValidateOnParse = False

    Dim SourceTagTagDict As Object
    Set SourceTagTagDict = CreateObject(<span style="color:#e6db74">&#34;Scripting.Dictionary&#34;</span>)
    SourceTagTagDict.CompareMode = vbBinaryCompare

    Dim xmlString As String
    Dim XmlNodes As IXMLDOMNodeList
    Dim XmlNode As IXMLDOMNode

    Dim Key As Range
    Set Key = ThisWorkbook.Sheets(<span style="color:#e6db74">&#34;Main&#34;</span>).Range(<span style="color:#e6db74">&#34;A2&#34;</span>)

    Dim count As Integer: count = <span style="color:#ae81ff">0</span>
    Dim CompareResult As String
    Dim MissingSource As Boolean: MissingSource = False
    Dim MissingTarget As Boolean: MissingTarget = False

    <span style="color:#960050;background-color:#1e0010">&#39;</span> loop through each key and compare
    Do Until IsEmpty(Key)
        MissingSource = False
        MissingTarget = False
        SourceTagTagDict.RemoveAll

         <span style="color:#960050;background-color:#1e0010">&#39;</span> Get the file xml <span style="color:#66d9ef">string</span> and cleanup
        xmlString = GetFileXML(<span style="color:#e6db74">&#34;file&#34;</span>, Key.Text)

        If Not xml.LoadXML(xmlString) Then
            MissingSource = True
            GoTo SkipSource
        End If

        Set XmlNodes = xml.ChildNodes().Item(<span style="color:#ae81ff">0</span>).ChildNodes() <span style="color:#960050;background-color:#1e0010">&#39;</span>Because We have only one XML document

        <span style="color:#960050;background-color:#1e0010">&#39;</span> load the dictionary with tag and <span style="color:#66d9ef">value</span>
        For Each XmlNode In XmlNodes
            SourceTagTagDict.Add XmlNode.BaseName, XmlNode.Text
        Next XmlNode

SkipSource:

        <span style="color:#960050;background-color:#1e0010">&#39;</span> Get the DB xml <span style="color:#66d9ef">string</span> and clean up
        xmlString = GetDBXML(<span style="color:#e6db74">&#34;database&#34;</span>, Key.Text)

        If Not xml.LoadXML(xmlString) Then
            MissingTarget = True
            GoTo SkipTarget
        End If

        Set XmlNodes = xml.ChildNodes().Item(<span style="color:#ae81ff">0</span>).ChildNodes() <span style="color:#960050;background-color:#1e0010">&#39;</span>We have only one XML document

SkipTarget:

        If MissingSource Or MissingTarget Then
            CompareResultCell.Value = Key.Text
            CompareResultCell.Offset(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>).Value = <span style="color:#e6db74">&#34;NA&#34;</span>
            CompareResultCell.Offset(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>).Value = <span style="color:#e6db74">&#34;NA&#34;</span>
            CompareResultCell.Offset(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">3</span>).Value = <span style="color:#e6db74">&#34;NA&#34;</span>
            CompareResultCell.Offset(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">4</span>).Value = <span style="color:#e6db74">&#34;Missing &#34;</span> &amp; IIf(MissingSource, <span style="color:#e6db74">&#34;File &#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>) &amp; IIf(MissingTarget, <span style="color:#e6db74">&#34;DB &#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>) &amp; <span style="color:#e6db74">&#34;XML&#34;</span>
            Set CompareResultCell = CompareResultCell.Offset(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>)
            count = count + <span style="color:#ae81ff">1</span>
            GoTo NextKeyCell
        End If

        <span style="color:#960050;background-color:#1e0010">&#39;</span> we have xmls <span style="color:#66d9ef">from</span> file and db both. compare.
        For Each XmlNode In XmlNodes
            If SourceTagTagDict.Exists(XmlNode.BaseName) Then
                <span style="color:#960050;background-color:#1e0010">&#39;</span> File xml matching tag exists

                If StrComp(XmlNode.Text, SourceTagTagDict.Item(XmlNode.BaseName), vbBinaryCompare) &lt;&gt; <span style="color:#ae81ff">0</span> Then
                    <span style="color:#960050;background-color:#1e0010">&#39;</span> the <span style="color:#66d9ef">value</span> don<span style="color:#960050;background-color:#1e0010">&#39;</span>t match
                    CompareResult = <span style="color:#e6db74">&#34;Mismatch&#34;</span>
                    count = count + <span style="color:#ae81ff">1</span>
                Else
                    <span style="color:#960050;background-color:#1e0010">&#39;</span> the values match
                    CompareResult = <span style="color:#e6db74">&#34;Match&#34;</span>
                End If

                <span style="color:#960050;background-color:#1e0010">&#39;</span> load the result
                CompareResultCell.Value = Key.Text
                CompareResultCell.Offset(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>).Value = XmlNode.BaseName
                CompareResultCell.Offset(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>).Value = SourceTagTagDict.Item(XmlNode.BaseName)
                CompareResultCell.Offset(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">3</span>).Value = XmlNode.Text
                CompareResultCell.Offset(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">4</span>).Value = CompareResult

                <span style="color:#960050;background-color:#1e0010">&#39;</span> <span style="color:#66d9ef">remove</span> the key <span style="color:#66d9ef">from</span> dictionary
                SourceTagTagDict.Remove (XmlNode.BaseName)
            Else
                <span style="color:#960050;background-color:#1e0010">&#39;</span> No File XML matching tag; <span style="color:#66d9ef">this</span> <span style="color:#66d9ef">is</span> only <span style="color:#66d9ef">in</span> DB
                CompareResultCell.Value = Key.Text
                CompareResultCell.Offset(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>).Value = XmlNode.BaseName
                CompareResultCell.Offset(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">3</span>).Value = XmlNode.Text
                CompareResultCell.Offset(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">4</span>).Value = <span style="color:#e6db74">&#34;DB Tag Only&#34;</span>

                count = count + <span style="color:#ae81ff">1</span>
            End If

            <span style="color:#960050;background-color:#1e0010">&#39;</span> move the cell one down
            Set CompareResultCell = CompareResultCell.Offset(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>)

        Next XmlNode

        <span style="color:#960050;background-color:#1e0010">&#39;</span> Loop through File XML tag dictionary and print. Theese are <span style="color:#66d9ef">in</span> File xml only
        Dim FileOnlyTag As Variant
        For Each FileOnlyTag In SourceTagTagDict.Keys()
            CompareResultCell.Value = Key.Text
            CompareResultCell.Offset(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>).Value = FileOnlyTag
            CompareResultCell.Offset(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>).Value = SourceTagTagDict.Item(FileOnlyTag)
            CompareResultCell.Offset(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">4</span>).Value = <span style="color:#e6db74">&#34;File Tag Only&#34;</span>

            <span style="color:#960050;background-color:#1e0010">&#39;</span> move the cell one down
            Set CompareResultCell = CompareResultCell.Offset(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>)
            count = count + <span style="color:#ae81ff">1</span>
        Next FileOnlyTag


NextKeyCell:
        <span style="color:#960050;background-color:#1e0010">&#39;</span> read the next key
        Set Key = Key.Offset(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>)

    Loop <span style="color:#960050;background-color:#1e0010">&#39;</span> Do Until


    <span style="color:#960050;background-color:#1e0010">&#39;</span> <span style="color:#66d9ef">add</span> border
    With CompareResultRange()
        With .Borders
            .LineStyle = xlContinuous
        End With
    End With
    ThisWorkbook.Sheets(<span style="color:#e6db74">&#34;Main&#34;</span>).Range(<span style="color:#e6db74">&#34;C2&#34;</span>).Select

    If count &gt; <span style="color:#ae81ff">0</span> Then
        MsgBox (count &amp; <span style="color:#e6db74">&#34; mismatches found!&#34;</span>)
    Else
        MsgBox (<span style="color:#e6db74">&#34;Success: XMLs match!&#34;</span>)
    End If
End Sub</code></pre></div>
<p><small>The <a href="https://github.com/lobopraveen/gists/blob/master/msexcel/xmlcompare/search_and_compare_multiple_XMLs.vba" target="_blank">latest version</a> of this should be available on <a href="https://github.com/lobopraveen/gists" target="_blank">GitHub repo</a>. Please report any issues there.</small></p>

<p>A sample excel file is also provided on the GitHub repo - <a href="https://github.com/lobopraveen/gists/blob/master/msexcel/xmlcompare/search_and_compare_multiple_XMLs.xlsb?raw=true" target="_blank">direct link</a>. Please note that the links to the file and the database info needs to be updated to suit the needs.</p>

<p>If you make any enhancement like color coding the result to make it more visual or make the code better in anyway, please submit a pull request and pass on the goodness!</p>

</div>

  
<footer class='entry-footer'>
  <div class='container sep-before'>
  <div class='categories'>
  <span class='taxonomy-icon'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M22,19a2,2,0,0,1-2,2H4a2,2,0,0,1-2-2V5A2,2,0,0,1,4,3H9l2,3h9a2,2,0,0,1,2,2Z"/>
  
</svg>
</span>
  <span class='screen-reader-text'>Categories: </span><a class='category' href='/categories/1'>1</a></div>
<div class='tags'>
  <span class='taxonomy-icon'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M20.59,13.41l-7.17,7.17a2,2,0,0,1-2.83,0L2,12V2H12l8.59,8.59A2,2,0,0,1,20.59,13.41Z"/>
  <line x1="7" y1="7" x2="7" y2="7"/>
  
</svg>
</span>
  <span class='screen-reader-text'>Tags: </span><a class='tag' href='/tags/xml'>Xml</a>, <a class='tag' href='/tags/vba'>Vba</a>, <a class='tag' href='/tags/excel'>Excel</a>, <a class='tag' href='/tags/power-query'>Power Query</a></div>

  </div>
</footer>


</article>

<nav class='entry-nav'>
  <div class='container'><div class='prev-entry sep-before'>
      <a href='/blog/comparing-two-xmls-in-excel-vba/'>
        <span aria-hidden='true'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="20" y1="12" x2="4" y2="12"/>
  <polyline points="10 18 4 12 10 6"/>
  
</svg>
 Previous</span>
        <span class='screen-reader-text'>Previous post: </span>Comparing Two XMLs In Excel VBA</a>
    </div><div class='next-entry sep-before'>
      <a href='/blog/holy-crap-missing-in-action/'>
        <span class='screen-reader-text'>Next post: </span>HOLY CRAP!!!<span aria-hidden='true'>Next <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="4" y1="12" x2="20" y2="12"/>
  <polyline points="14 6 20 12 14 18"/>
  
</svg>
</span>
      </a>
    </div></div>
</nav>


<section id='comments' class='comments'>
  <div class='container sep-before'>
    <div class='comments-area'><div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "lobopraveen" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
  </div>
</section>

      </main>

      <footer id='footer' class='footer'>
        <div class='container sep-before'>
          <section class='widget widget-social_menu sep-after'><nav aria-label='Social Menu'>
    <ul><li>
        <a href='mailto:lobopraveen@gmail.com' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Contact via Email</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
  <polyline points="22,6 12,13 2,6"/>
  
</svg>
</a>
      </li><li>
        <a href='https://linkedin.com/in/lobopraveen' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Open Linkedin account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/>
  <rect x="2" y="9" width="4" height="12"/>
  <circle cx="4" cy="4" r="2"/>
  
</svg>
</a>
      </li><li>
        <a href='https://github.com/lobopraveen' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Open Github account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
  
</svg>
</a>
      </li><li>
        <a href='https://stackoverflow.com/users/319542' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Open Stackoverflow account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M18.986 21.865v-6.404h2.134V24H1.844v-8.539h2.13v6.404h15.012zM6.111 19.731H16.85v-2.137H6.111v2.137zm.259-4.852l10.48 2.189.451-2.07-10.478-2.187-.453 2.068zm1.359-5.056l9.705 4.53.903-1.95-9.706-4.53-.902 1.936v.014zm2.715-4.785l8.217 6.855 1.359-1.62-8.216-6.853-1.35 1.617-.01.001zM15.751 0l-1.746 1.294 6.405 8.604 1.746-1.294L15.749 0h.002z"/>
  
</svg>
</a>
      </li><li>
        <a href='https://facebook.com/lobopraveen' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Open Facebook account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/>
  
</svg>
</a>
      </li><li>
        <a href='https://twitter.com/lobopraveen' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Open Twitter account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
  
</svg>
</a>
      </li><li>
        <a href='https://instagram.com/lobopraveen' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Open Instagram account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <rect x="2" y="2" width="20" height="20" rx="5" ry="5"/>
  <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/>
  <line x1="17.5" y1="6.5" x2="17.5" y2="6.5"/>
  
</svg>
</a>
      </li></ul>
  </nav>
</section>
          <div class='copyright'>
  <p> &copy; 2018 Praveen Lobo </p>
</div>

        </div>
      </footer>

    </div>
  </div><script>window.__public_path__='\/assets\/js\/'</script>

<script src='/assets/js/main.53e19345.js'></script><script src='/js/custom.js'></script>
</body>

</html>

