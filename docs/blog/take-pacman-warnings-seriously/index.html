<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='Especially when the kernel is upgraded!'><meta name=theme-color content='grey'><meta property='og:title' content='Take Pacman Warnings Seriously • Praveen Lobo'><meta property='og:description' content='Especially when the kernel is upgraded!'><meta property='og:url' content='https://praveenlobo.com/blog/take-pacman-warnings-seriously/'><meta property='og:site_name' content='Praveen Lobo'><meta property='og:type' content='article'><meta property='article:section' content='blog'><meta property='article:tag' content='ArchLinux'><meta property='article:tag' content='Linux'><meta property='article:tag' content='Pacman'><meta property='article:tag' content='VirtualBox'><meta property='article:tag' content='Packer'><meta property='article:tag' content='Vagrant'><meta property='article:tag' content='VMDK'><meta property='article:tag' content='initramfs'><meta property='article:published_time' content='2024-11-22T00:00:00Z'><meta property='article:modified_time' content='2024-11-22T00:00:00Z'><meta name=twitter:card content='summary'><meta name=generator content="Hugo 0.147.5"><title>Take Pacman Warnings Seriously • Praveen Lobo</title><link rel=canonical href=https://praveenlobo.com/blog/take-pacman-warnings-seriously/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.e45c9137.css><link rel=stylesheet href=/css/custom.css><style>:root{--color-accent:grey}</style></head><body class='page type-blog'><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class='menu main-menu' aria-label='Main Menu'><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/search>Search</a></li><li class=item><a href=/blog>Blog</a></li><li class=item><a href=/reviews-and-referral-links>Reviews</a></li><li class=item><a href=/archive>Archive</a></li><li class=item><a href=/subscribe>Subscribe</a></li><li class=item><a href=/contact>Contact</a></li><li class=item><a href=/about>About</a></li></ul></div></nav><div class=header-widgets><div class=container></div></div><header id=header class='header site-header'><div class='container sep-after'><div class=header-info><p class='site-title title'>Praveen Lobo</p><p class='desc site-desc'></p></div></div></header><main id=content><article lang=en class=entry><header class='header entry-header'><div class='container sep-after'><div class=header-info><h1 class=title>Take Pacman Warnings Seriously</h1><p class=desc>Especially when the kernel is upgraded!</p></div><div class=entry-meta><span class=posted-on><svg class="icon" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
<span class=screen-reader-text>Posted on </span><time class=entry-date datetime=2024-11-22T00:00:00Z>Fri, Nov 22, 2024</time>
</span><span class=reading-time><svg class="icon" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>
7 mins read</span></div></div></header><div class='container entry-content'><p>Take pacman Warnings seriously esp. when kernel is upgraded!</p><p>I have Packer and Vagrant setup to create arch Linux virtual machines. I create new VMs for various tasks and throw them out once done. I do have one or two VMs that I just keep long term. One of those VMs didn&rsquo;t boot up after an update. <code>pacman -Syuu</code> updated many packages and the kernel was upgraded to 6.11.8. I remember catching some warning in the corner of my eye as I was closing the terminal. I didn&rsquo;t think much about it and went about my business until I tried to boot it up.</p><p>Typically, I&rsquo;d just discard the VM but I needed to get something out of the VM so down the rabbit hole I went.</p><p>The VM boot process just hung with the following text:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Booting &#39;Arch Linux&#39;
</span></span><span style=display:flex><span>Loading Linux linux ...
</span></span><span style=display:flex><span>Loading initial ramdisk ...
</span></span><span style=display:flex><span>ata1.00 read log 0x00 page 0x00 failed, Emask 0x1
</span></span></code></pre></div><p>I couldn&rsquo;t get any good leads on the read log failed message; however, I did come across pages that mentioned that this is a warning message and can be ignored. I tried boot from fallback option but same result.</p><p>I thought the VirtualBox software upgrade which I had just done the same day may have broken the VM so I deleted the machine and recreated it with the same VMDK. I should have noted down the settings before deleting but oops! I just went with whatever I felt is right. I rebooted the VM to the same message: <code>ata1.00 read log 0x00 page 0x00 failed, Emask 0x1</code> and it just stuck there.</p><p>I downgraded the VirtualBox, unchecked solid-state checkbox, disabled 3D acceleration etc. but nothing helped. I did fool around a little bit with VirtualBox settings such as AHCI, SATA, USB controller etc. and the boot now started hanging after <code>Loading initial ramdisk ...</code></p><p>I didn’t change anything on the VM disk. I couldn’t have because the VM never booted. In any case, I decided to investigate the hard disc. I opened the VMDK file up in 7zip but the .img files failed to open with <code>Couldn’t Mount File: The disc image file is corrupted.</code> error. That didn&rsquo;t sound good, and I was about to give up but then decided to add the VMDK image as a second disk to another working VM. Let’s call that backup VM.</p><p>I could have booted my broken VM from an Arch ISO, mounted the disk, <code>arch-chroot</code> and <code>pacman -S linux</code> to fix the boot issue. Since I never attached a VMDK as disk to another VM, I decided to give that a go first.</p><p>I created a backup copy of the broken VMDK just in case I end of destroying the original. I tried to add that copy to VirtualBox media manager (Ctrl+D) but it complained that the UUID is already taken so I changed the UUID using the command: <code>.\VBoxManage.exe internalcommands sethduuid arch-copy.vhdk</code></p><p>I shouldn&rsquo;t have changed UUID. You will see why below. Anyway, I added the VMDK as hard disk. I picked a backup VM (with kernel 6.10.5 I believe) and added the broken VMDK as the second hard disk and booted it up. Once in the machine, I found the device label using <code>lsblk</code> and mounted it to <code>/mnt</code>. I did <code>chroot</code> but <code>pacman -S linux</code> was throwing some block device related error. <code>arch-chroot</code> does setup a few things before chrooting but I didn&rsquo;t want to spend more time than I already did so I exited <code>chroot</code>.</p><p>I knew grub printed the “loading” message so I went to <code>/mnt/boot/grub/grub.cfg</code> (notice <code>/mnt</code> at the beginning) and it looked ok. The UUID mentioned matched with the UUID from <code>sudo blkid</code>. Then I noticed that the initramfs files were zero byte! I have no idea how that could be. I suspect that in a rush I powered off the VM and the file wasn&rsquo;t written to the disk. I had the storage controller with <code>Use Host I/O cache</code> enabled which may have not yet written to the file. I don&rsquo;t like the fact that VirtualBox defaults the close dialog to whatever was used last in any vm! I had powered off some other VMs that were hung just before so when I closed the VM and pressed ok, the setting must have been on power off rather than send shutdwon signal.</p><p>I copied the initramfs files from the backup VM to the hard disk of the broken VM that I had mounted.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo cp /boot/initramfs-linux.img /mnt/boot/initramfs-linux.img
</span></span><span style=display:flex><span>sudo cp /boot/initramfs-linux-fallback.img /mnt/boot/initramfs-linux-fallback.img
</span></span></code></pre></div><p>I shutdown the backup VM and removed the extra disk from it. Then I detached the VMDK from the broken VM and attached the one I had just copied initramfs into as the disk. The boot process moved past loading the initramfs but it dropped me down into an emergency shell!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>ERROR: device &#39;UUID=xxx-xxx-xxx-xxx&#39; not found. Skipping fsck.
</span></span><span style=display:flex><span>mount: /new_root: can&#39;t find UUID=xxx-xxx-xxx-xxx.
</span></span><span style=display:flex><span>ERROR: Failed to mount &#39;UUID=xxx-xxx-xxx-xxx&#39; or real root.
</span></span><span style=display:flex><span>You are now being dropped into an emergency shell.
</span></span><span style=display:flex><span>sh: can&#39;t access tty: job control turned off
</span></span><span style=display:flex><span>[rootfs ~]#
</span></span></code></pre></div><p>Unfortunately, this terminal is untouchable! It doesn&rsquo;t register any keystrokes as it clearly indicates so it was useless and I had to power it down. This UUID error was why I shouldn&rsquo;t have changed the UUID of the VMDK. I should have removed the disk from the broken VM and removed the disk from the VirtualBox and then added the copy. Or just left the copy outside and attached the broken disk directly backup VM. What surprised me is that the UUID in the <code>grub.conf</code> was same as the UUID shown by <code>blkid</code>. I didn’t want to go down that rabbit hole!</p><p>I decided to delete the copy with changed UUID and start over. I backed up the broken VMDK, added the original back into VirtualBox, and then into the broken VM as well as a backup VM. I booted up the backup VM, this time I decided to update the backup VM with <code>pacman -Syuu</code> which installed kernel 6.11.9. I coped the initramfs over the broken VMDK disk which had 6.11.8.</p><p>That was it! I was able to successfully boot up the broken VM. I then updated the system with <code>arch_update</code> (which is an alias for <code>yay -Syuu && paccache -r && paccache -ruk0</code>) and I noticed the warning again. This time I paid attention!</p><p>The warning was about the preset file <code>/etc/mkinitcpio.d/linux.preset</code> being empty. It indeed was a zero-byte file. I then checked <code>/boot</code> and found that unlike the last time where the initramfs files were both zero-byte, this time they were both gone. <a href=https://wiki.archlinux.org/title/Mkinitcpio#Automated_generation>Kernel upgrade should generate</a> the preset file if it is not there but for some reason, if it exist as a zero-byte file, it doesn&rsquo;t regenerate it and throws a warning. I ended up deleting the preset file and reinstalled the kernel using <code>pacman -S linux</code>. This created the preset file and the initramfs files were back again!</p><p>I rebooted the VM but found that all Gnome applications were big unusable unreadable white banners. Just white windows with nothing visible in it! I had to disable the 3D acceleration for them to work properly. I then cleaned up all the mess I had made.</p><p>After dealing with all this, I’m leaning towards creating a backup process to back up the home directory to the Vagrant shared folder. I could run it as a cronjob or just update the <code>arch_update</code> alias to backup before upgrade. This would work if I don’t make modifications to the VM directly and always make them in the Packer + Vagrant scripts. I can then just spin up a new VM and copy over the home directory from the backup. Alternatively, I can have another disk mounted as home and avoid the aforementioned scripting work but I would have to update Packer + Vagrant setup to duplicate the home disk, change UUID, and mount that as home while creating new VMs. That would break the ephemeral VM idea I suppose. I think I will save this for some other day!</p></div><footer class=entry-footer><div class='container sep-before'><div class=categories><svg class="icon" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg>
<span class=screen-reader-text>Categories: </span><a class=category href=/categories/1/>1</a></div><div class=tags><svg class="icon" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=screen-reader-text>Tags: </span><a class=tag href=/tags/archlinux/>ArchLinux</a>, <a class=tag href=/tags/linux/>Linux</a>, <a class=tag href=/tags/pacman/>Pacman</a>, <a class=tag href=/tags/virtualbox/>VirtualBox</a>, <a class=tag href=/tags/packer/>Packer</a>, <a class=tag href=/tags/vagrant/>Vagrant</a>, <a class=tag href=/tags/vmdk/>VMDK</a>, <a class=tag href=/tags/initramfs/>Initramfs</a></div></div></footer></article><nav class=entry-nav><div class=container><div class='prev-entry sep-before'><a href=/blog/mortgage-loan-and-refinancing-comparison/><span aria-hidden=true><svg class="icon" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>
Previous</span>
<span class=screen-reader-text>Previous post: </span>To Refinance Or Not To Refinance</a></div></div></nav><section id=comments class=comments><div class='container sep-before'><div class=comments-area><div id=submission-success class=comment-submission-feedback><h4>Thank You!</h4><span>Your comment has been submitted. It will appear on this page shortly!</span>
<a href=#comments class=button>OK</a></div><div id=submission-failure class=comment-submission-feedback><h4>Yikes, Sorry!</h4><span>Error occured. Couldn't submit your comment. Please try again. Thank You!</span>
<a href=#comments class=button>OK</a></div><div id=respond class=comment-respond><h4 class=comment-reply-title>Leave a comment<small>
<a rel=nofollow id=cancel-comment-reply-link href=#respond class=button style=display:none aria-label='Cancel comment'>Cancel</a></small></h4><form action=https://api.staticman.net/v2/entry/lobopraveen/praveenlobo.com/master/comments method=post id=comment-form class=comment-form><input type=hidden name=options[postId] value=a8199cb5c6c908248edc4836e8121717>
<input type=hidden name=options[redirect] value=https://praveenlobo.com/blog/take-pacman-warnings-seriously/#submission-success>
<input type=hidden name=options[redirectError] value=https://praveenlobo.com/blog/take-pacman-warnings-seriously/#submission-failure>
<input type=address name=fields[honeypot] style=display:none>
<input type=hidden name=fields[permalink] value=/blog/take-pacman-warnings-seriously/>
<input type=hidden name=fields[parent_id]><input type=hidden name=options[reCaptcha][siteKey] value=6LeSCGoUAAAAADS2jeaiTgzwi_hIQQ2uVumPxpsp>
<input type=hidden name=options[reCaptcha][secret] value='Wb4JOmR/cOt0fkaJ9gKxRarj8ADX1rSsI/jSVhpkNlINwcPCBSSfNKcZrDvQs8sSrQAUPWDILqHpYubB2TFR1raeVjrHuKvwChypXYOQzgN5lIEiL/8dN0UkG9kAc5qbheLJldGnaEiZiDrBTZmCM0kopP+G/MtNjrVXfKvigZo='><div><label for=comment>Comment*</label>
<textarea id=comment name=fields[content] required rows=3></textarea></div><div><label for=name>Name*</label>
<input id=name name=fields[author] type=text required></div><div><label for=email>Email*</label>
<input id=email name=fields[email] type=email required></div><div><label for=url>Website</label>
<input id=url name=fields[site] type=url></div><div class=g-recaptcha data-sitekey=6LeSCGoUAAAAADS2jeaiTgzwi_hIQQ2uVumPxpsp data-callback=enableSubmitComment></div><script type=text/javascript>function enableSubmitComment(){document.getElementById("submitComment").disabled=!1}</script><script async src=https://www.google.com/recaptcha/api.js></script><div><button type=submit id=submitComment disabled>Comment!</button></div></form></div></div></div></section></main><footer id=footer class=footer><div class='container sep-before'><section class='widget widget-social_menu sep-after'><nav aria-label='Social Menu'><ul><li><a href=mailto:gmail@praveenlobo.com target=_blank rel='noopener me'><span class=screen-reader-text>Contact via Email</span><svg class="icon" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/lobopraveen target=_blank rel='noopener me'><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li><li><a href=https://github.com/lobopraveen target=_blank rel='noopener me'><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=%3cnil%3e319542 target=_blank rel='noopener me'><span class=screen-reader-text>Open Stackoverflow account in new tab</span><svg class="icon" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M18.986 21.865v-6.404h2.134V24H1.844v-8.539h2.13v6.404h15.012zM6.111 19.731H16.85v-2.137H6.111v2.137zm.259-4.852 10.48 2.189.451-2.07-10.478-2.187-.453 2.068zm1.359-5.056 9.705 4.53.903-1.95-9.706-4.53-.902 1.936v.014zm2.715-4.785 8.217 6.855 1.359-1.62-8.216-6.853-1.35 1.617-.01.001zM15.751.0l-1.746 1.294 6.405 8.604 1.746-1.294L15.749.0h.002z"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2018-2025 Praveen Lobo</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.56dcff95.js></script><script src=/js/custom.js></script></body></html>